<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste da API Gemini</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-form { display: flex; flex-direction: column; gap: 10px; }
        .test-form input, .test-form select, .test-form textarea { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .test-form button { padding: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-form button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .loading { border-left-color: #ffc107; background: #fff3cd; }
        pre { background: #f1f3f4; padding: 10px; border-radius: 4px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste da Integra√ß√£o com Google Gemini</h1>
        
        <form class="test-form" id="testForm">
            <input type="text" id="enderecoPartida" placeholder="Endere√ßo de partida" value="S√£o Paulo, SP" required aria-label="Endere√ßo de partida">
            <input type="number" id="orcamento" placeholder="Or√ßamento (R$)" value="300" required aria-label="Or√ßamento em reais">
            <select id="tipoMoto" required>
                <option value="naked">Naked (CB600, MT07)</option>
                <option value="esportiva">Esportiva (CBR, R6)</option>
                <option value="custom">Custom (Harley, Shadow)</option>
                <option value="trail">Trail/Adventure (Tenere, GS)</option>
            </select>
            <select id="nivelAventura" required>
                <option value="tranquilo">Tranquilo</option>
                <option value="moderado" selected>Moderado</option>
                <option value="aventureiro">Aventureiro</option>
            </select>
            <textarea id="experienciaDesejada" placeholder="Que tipo de experi√™ncia voc√™ quer?" rows="3">Quero conhecer cachoeiras e lugares com natureza exuberante</textarea>
            <button type="submit">üöÄ Testar Gera√ß√£o de Roteiro</button>
        </form>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script src="config.js"></script>
    <script>
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result loading';
            resultDiv.innerHTML = '‚è≥ Testando conex√£o com Gemini...';
            
            const formData = {
                enderecoPartida: document.getElementById('enderecoPartida').value,
                dataRole: new Date().toISOString().split('T')[0],
                horarioSaida: '08:00',
                horarioVolta: '18:00',
                orcamento: parseInt(document.getElementById('orcamento').value),
                tipoMoto: document.getElementById('tipoMoto').value,
                perfilPilotagem: 'equilibrado',
                experienciaDesejada: document.getElementById('experienciaDesejada').value,
                nivelAventura: document.getElementById('nivelAventura').value,
                companhia: 'sozinho',
                preferencias: ['natureza']
            };
            
            try {
                // Usar mesma configura√ß√£o do gerador
                const apiConfig = getAPIConfig();
                
                const prompt = `Voc√™ √© um especialista em turismo rodovi√°rio e motociclismo no Brasil. Crie um roteiro detalhado para um rol√™ de moto baseado nestas informa√ß√µes:
                
DADOS DO ROL√ä:
- Ponto de partida: ${formData.enderecoPartida}
- Data: ${formData.dataRole}
- Or√ßamento total: R$ ${formData.orcamento}
- Tipo de moto: ${formData.tipoMoto}
- N√≠vel de aventura: ${formData.nivelAventura}
- Experi√™ncia desejada: ${formData.experienciaDesejada}

Retorne um JSON v√°lido com um roteiro personalizado. Use destinos reais no Brasil.`;
                
                console.log('üîß API Config:', apiConfig);
                console.log('üß† Prompt:', prompt.substring(0, 200) + '...');
                
                const response = await fetch(apiConfig.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.8,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 2048,
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üì• Resposta completa:', data);
                
                if (!data.candidates || !data.candidates[0]?.content?.parts?.[0]?.text) {
                    throw new Error('Resposta inv√°lida da IA');
                }
                
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Teste Bem-Sucedido!</h3>
                    <p><strong>Status:</strong> Conectado ao Google Gemini</p>
                    <p><strong>Modelo:</strong> gemini-2.5-flash-preview</p>
                    <p><strong>Resposta da IA:</strong></p>
                    <pre>${aiResponse}</pre>
                    <p><strong>Dados do Request:</strong></p>
                    <pre>${JSON.stringify(formData, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Erro no Teste</h3>
                    <p><strong>Erro:</strong> ${error.message}</p>
                    <p><strong>Poss√≠veis causas:</strong></p>
                    <ul>
                        <li>Chave de API inv√°lida ou expirada</li>
                        <li>Modelo indispon√≠vel</li>
                        <li>Limite de requisi√ß√µes atingido</li>
                        <li>Problemas de conectividade</li>
                    </ul>
                    <p><strong>Dados tentados:</strong></p>
                    <pre>${JSON.stringify(formData, null, 2)}</pre>
                `;
            }
        });
        
        // Mesma fun√ß√£o de configura√ß√£o do gerador.js
        function getAPIConfig() {
            if (typeof window !== 'undefined' && window.SOP_CONFIG) {
                return {
                    apiKey: window.SOP_CONFIG.apiKey,
                    apiUrl: window.SOP_CONFIG.textUrl
                };
            }
            return {
                apiKey: 'API_KEY_REMOVED_FOR_SECURITY',
                apiUrl: 'API_URL_REMOVED_FOR_SECURITY'
            };
        }
    </script>
</body>
</html>